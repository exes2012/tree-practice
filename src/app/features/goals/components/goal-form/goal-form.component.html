<app-practice-page-layout [title]="isEditMode ? 'Ваша цель' : 'Новая цель'">
  <div class="surface min-h-screen p-4 pt-8">
    <form (ngSubmit)="saveGoal()">
      <div class="mb-5">
        <label class="text-primary mb-2 block font-semibold">Установка фото цели:</label>
        <div class="border-2 border-dashed border-neutral-300 relative cursor-pointer rounded-lg p-5 text-center transition-colors duration-300 hover:border-green-500 dark:border-neutral-600 dark:hover:border-green-400" (click)="triggerFileInput()">
          <div *ngIf="!goal.imageUrl" class="text-muted flex flex-col items-center">
            <i class="material-icons mb-2 text-5xl text-neutral-300 dark:text-neutral-600">add_a_photo</i>
            <span class="text-sm">Выберите фото</span>
          </div>
          <div *ngIf="goal.imageUrl" class="group relative inline-block">
            <img [src]="goal.imageUrl" alt="Goal Image Preview" class="max-h-40 max-w-xs rounded" />
            <div class="absolute inset-0 flex items-center justify-center rounded bg-black/50 opacity-0 transition-opacity duration-300 group-hover:opacity-100">
              <i class="material-icons text-2xl text-white">edit</i>
            </div>
          </div>
        </div>
        <input
          type="file"
          #fileInput
          (change)="onFileSelected($event)"
          accept="image/*"
          class="hidden"
        />
      </div>

      <div class="mb-5">
        <label for="title" class="text-primary mb-2 block font-semibold">Напишите вашу цель здесь:</label>
        <textarea
          id="title"
          [(ngModel)]="goal.title"
          name="title"
          required
          rows="2"
          placeholder="Опишите вашу цель..."
          class="surface-elevated w-full resize-y rounded-lg border border-subtle p-4 text-base text-primary placeholder-muted focus:outline-none focus:ring-2 focus:ring-primary-500/50"
        ></textarea>
      </div>

      <div class="mb-5">
        <label for="complexity" class="text-primary mb-2 block font-semibold">Сложность: {{ goal.complexity }}%</label>
        <input
          type="range"
          id="complexity"
          [(ngModel)]="goal.complexity"
          name="complexity"
          min="0"
          max="100"
          class="w-full rounded-lg border border-subtle p-2.5"
        />
        <p class="text-muted mt-1 text-sm">Укажите предполагаемую сложность достижения цели</p>
      </div>

      <div class="mb-5">
        <label class="text-primary mb-2 block font-semibold">Направление:</label>
        <div class="grid grid-cols-2 gap-3">
          <div
            class="surface-elevated flex min-h-11 cursor-pointer items-center justify-center rounded-lg border-2 border-pink-600 px-1.5 py-2 text-center text-xs font-semibold leading-tight text-primary transition-all duration-300"
            [class.selected]="goal.direction === 'relationships'"
            (click)="selectDirection('relationships')"
          >
            Отношения
          </div>
          <div
            class="surface-elevated flex min-h-11 cursor-pointer items-center justify-center rounded-lg border-2 border-green-600 px-1.5 py-2 text-center text-xs font-semibold leading-tight text-primary transition-all duration-300"
            [class.selected]="goal.direction === 'health'"
            (click)="selectDirection('health')"
          >
            Здоровье
          </div>
          <div
            class="surface-elevated flex min-h-11 cursor-pointer items-center justify-center rounded-lg border-2 border-amber-700 px-1.5 py-2 text-center text-xs font-semibold leading-tight text-primary transition-all duration-300"
            [class.selected]="goal.direction === 'money'"
            (click)="selectDirection('money')"
          >
            Деньги
          </div>
          <div
            class="surface-elevated flex min-h-11 cursor-pointer items-center justify-center rounded-lg border-2 border-primary-500 px-1.5 py-2 text-center text-xs font-semibold leading-tight text-primary transition-all duration-300"
            [class.selected]="goal.direction === 'destiny'"
            (click)="selectDirection('destiny')"
          >
            Предназначение
          </div>
        </div>
      </div>

      <div class="mb-5">
        <div class="flex items-center gap-2">
          <input type="checkbox" id="isMainGoal" [(ngModel)]="goal.isMainGoal" name="isMainGoal" class="m-0 w-auto" />
          <label for="isMainGoal" class="text-primary m-0 font-bold">Главная цель</label>
        </div>
        <p class="text-muted mt-1 text-sm">
          Главная цель будет отображаться вверху списка целей. Главная цель может быть только одна.
        </p>
      </div>

      <button type="submit" class="btn btn-primary mx-auto mt-5 block w-full max-w-xs disabled:cursor-not-allowed disabled:opacity-50 disabled:shadow-none disabled:transform-none" [disabled]="!isFormValid()">
        {{ isEditMode ? 'Сохранить' : 'Добавить' }}
      </button>
    </form>
  </div>
</app-practice-page-layout>