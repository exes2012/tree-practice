<!-- Home Header -->
<app-home-header></app-home-header>

<!-- Fixed Top Section -->
<div
  #fixedSection
  class="fixed-section surface fixed left-0 right-0 top-0 z-40"
>
  <div class="container mx-auto space-y-4 px-4 pb-4 pt-4">
    <!-- Statistics -->
    <div class="surface-elevated rounded-xl px-1 py-2 shadow-sm">
      <div class="grid grid-cols-4 gap-0.5">
        <!-- Streak -->
        <div class="stat-card">
          <div class="stat-icon-wrapper">
            <div class="stat-icon bg-custom-fire/10">
              <i class="material-icons text-custom-fire text-xs">local_fire_department</i>
            </div>
            <div class="stat-value">{{ stats.streak }}</div>
          </div>
          <div class="stat-label">дней подряд</div>
        </div>

        <!-- Total Practices -->
        <div class="stat-card">
          <div class="stat-icon-wrapper">
            <div class="stat-icon bg-custom-chart/10">
              <i class="material-icons text-custom-chart text-xs">bar_chart</i>
            </div>
            <div class="stat-value">
              {{ stats.totalPractices }}
            </div>
          </div>
          <div class="stat-label">практик</div>
        </div>

        <!-- Total Practice Days -->
        <div class="stat-card">
          <div class="stat-icon-wrapper">
            <div class="stat-icon bg-custom-calendar/10">
              <i class="material-icons text-custom-calendar text-xs">calendar_today</i>
            </div>
            <div class="stat-value">
              {{ totalPracticeDays }}
            </div>
          </div>
          <div class="stat-label">дней всего</div>
        </div>

        <!-- Total Practice Time -->
        <div class="stat-card">
          <div class="stat-icon-wrapper">
            <div class="stat-icon bg-custom-schedule/10">
              <i class="material-icons text-custom-schedule text-xs">schedule</i>
            </div>
            <div class="stat-value">
              {{ formatDuration(totalPracticeTime) }}
            </div>
          </div>
          <div class="stat-label">
            {{ formatDurationLabel(totalPracticeTime) }}
          </div>
        </div>
      </div>
    </div>

    <!-- Daily Challenge -->
    <div *ngIf="dailyChallenge" class="card-padded">
      <div (click)="toggleChallenge()" class="flex cursor-pointer items-center justify-between">
        <div class="flex items-center">
          <div
            class="mr-3 flex h-10 w-10 items-center justify-center rounded-full bg-custom-psychology/10"
          >
            <i class="material-icons text-custom-psychology text-lg">psychology</i>
          </div>
          <h3 class="text-primary text-sm font-semibold">
            Намерение дня: {{ dailyChallenge.title }}
          </h3>
        </div>
        <svg
          class="text-muted h-5 w-5 transition-transform duration-300"
          [class.rotate-180]="isChallengeExpanded"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 9l-7 7-7-7"
          ></path>
        </svg>
      </div>
      <div *ngIf="isChallengeExpanded" class="pl-13 mt-3">
        <p class="text-secondary whitespace-pre-line text-xs">
          {{ dailyChallenge.description }}
        </p>
        <button (click)="clearChallenge()" class="mt-2 text-xs text-red-500 hover:underline">
          Удалить намерение
        </button>
      </div>
    </div>

    <!-- Repeat Last Practice -->
    <div
      *ngIf="lastPractice"
      class="card-padded flex items-center justify-between"
    >
      <div class="flex items-center">
        <div class="mr-3 flex h-10 w-10 items-center justify-center rounded-full bg-custom-history/10">
          <i class="material-icons text-custom-history text-lg">history</i>
        </div>
        <div>
          <h3 class="text-primary text-sm font-semibold">Последняя практика</h3>
          <p class="text-secondary text-xs">{{ lastPractice.name }}</p>
        </div>
      </div>
      <button
        (click)="repeatLastPractice()"
        [disabled]="!lastPractice"
        class="btn btn-primary rounded-lg px-4 py-2 text-sm font-medium disabled:cursor-not-allowed disabled:opacity-50"
      >
        Повторить
      </button>
    </div>
  </div>
</div>

<!-- Scrollable Practices Section -->
<div
  class="scrollable-section surface pb-24"
  [style.padding-top.px]="practicesTopPadding"
>
  <div class="container mx-auto px-4">
    <!-- Tabs -->
    <div class="mb-4 flex rounded-xl bg-neutral-100 p-1 dark:bg-neutral-800">
      <button
        (click)="switchTab('right')"
        [class]="
          'flex-1 rounded-lg px-4 py-3 text-sm font-medium transition-all duration-200 ' +
          (activeTab === 'right'
            ? 'surface-elevated text-primary shadow-sm'
            : 'text-muted hover:text-neutral-700 dark:hover:text-neutral-300')
        "
      >
        Правая линия
      </button>
      <button
        (click)="switchTab('left')"
        [class]="
          'flex-1 rounded-lg px-4 py-3 text-sm font-medium transition-all duration-200 ' +
          (activeTab === 'left'
            ? 'surface-elevated text-primary shadow-sm'
            : 'text-muted hover:text-neutral-700 dark:hover:text-neutral-300')
        "
      >
        Левая линия
      </button>
    </div>

    <!-- Right Line Practices -->
    <div *ngIf="activeTab === 'right'" class="@container">
      <div class="grid grid-cols-1 gap-4 @md:grid-cols-2">
        <div
          (click)="navigateToPractice('basic')"
          class="practice-card"
        >
          <span
            class="practice-level-badge bg-custom-sunny/10"
            >Уровень 1</span
          >
          <div class="practice-icon-wrapper bg-custom-sunny/10">
            <i class="material-icons text-custom-sunny text-xl">wb_sunny</i>
          </div>
          <div class="flex-1">
            <h3 class="practice-title">
              Базовые упражнения
            </h3>
            <p class="practice-description">
              Настройка на свет, 4 стадии прямого света
            </p>
          </div>
        </div>
        <div
          (click)="navigateToPractice('small-state')"
          class="practice-card"
        >
          <span
            class="practice-level-badge bg-custom-self-improvement/10"
            >Уровень 2</span
          >
          <div
            class="practice-icon-wrapper bg-custom-self-improvement/10"
          >
            <i class="material-icons text-custom-self-improvement text-xl">self_improvement</i>
          </div>
          <div class="flex-1">
            <h3 class="practice-title">
              Малое состояние
            </h3>
            <p class="practice-description">
              Умаление своего Эго перед Творцом
            </p>
          </div>
        </div>
        <div
          (click)="navigateToPractice('yichudim')"
          class="practice-card"
        >
          <span
            class="practice-level-badge bg-custom-auto-awesome/10"
            >Уровень 3</span
          >
          <div
            class="practice-icon-wrapper bg-custom-auto-awesome/10"
          >
            <i class="material-icons text-custom-auto-awesome text-xl">auto_awesome</i>
          </div>
          <div class="flex-1">
            <h3 class="practice-title">Ихудим</h3>
            <p class="practice-description">Практики слияния с Творцом</p>
          </div>
        </div>
        <div
          (click)="navigateToPractice('intention')"
          class="practice-card"
        >
          <span
            class="practice-level-badge bg-custom-track-changes/10"
            >Уровень 4</span
          >
          <div
            class="practice-icon-wrapper bg-custom-track-changes/10"
          >
            <i class="material-icons text-custom-track-changes text-xl">track_changes</i>
          </div>
          <div class="flex-1">
            <h3 class="practice-title">Каванот</h3>
            <p class="practice-description">
              Работа в намерении по Бааль Суламу
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Left Line Practices -->
    <div *ngIf="activeTab === 'left'" class="@container">
      <div class="grid grid-cols-1 gap-4 @md:grid-cols-2">
        <div
          (click)="navigateToPractice('man')"
          class="practice-card"
        >
          <span
            class="practice-level-badge bg-custom-man/10"
            >Уровень 2</span
          >
          <div class="practice-icon-wrapper bg-custom-man/10">
            <i class="material-icons text-custom-man text-xl">man</i>
          </div>
          <div class="flex-1">
            <h3 class="practice-title">Подъем МАН</h3>
            <p class="practice-description">
              Работа с получающими сосудами, подъем МАН
            </p>
          </div>
        </div>
        <div
          (click)="navigateToGoals()"
          class="practice-card"
        >
          <div
            class="practice-icon-wrapper bg-custom-my-location/10"
          >
            <i class="material-icons text-custom-my-location text-xl">my_location</i>
          </div>
          <div class="flex-1">
            <h3 class="practice-title">Цели с Творцом</h3>
            <p class="practice-description">
              Достижение целей вместе с Творцом
            </p>
          </div>
        </div>
        <div
          class="practice-card cursor-not-allowed opacity-50"
        >
          <div class="practice-icon-wrapper bg-custom-trending/10">
            <i class="material-icons text-custom-trending text-xl">trending_up</i>
          </div>
          <div class="flex-1">
            <h3 class="practice-title">
              Выход из падения
            </h3>
            <p class="practice-description">Скоро...</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>