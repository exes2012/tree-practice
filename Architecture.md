# Инструкция для агента: Полный аудит Angular приложения

Агент должен выполнить полный аудит Angular приложения, проанализировать код, выявить проблемы, предложить, что удалить, переделать в компоненты/сервисы и модернизировать под Angular 2024-2025. Фокус только на анализе кода, без тестов, деплоя, мониторинга или документации. Включить проверки доступности (a11y), безопасности (OWASP) и рекомендации по миграции на zoneless архитектуру.

---

## Фаза 1: Предварительный анализ кода

### Статический анализ:
- Запустить `ng lint`, описать все ошибки/предупреждения для исправления.  
- Использовать `npx ngx-unused . -p tsconfig.json` для поиска неиспользуемых компонентов и сервисов. Составить список для удаления.  
- Выполнить `npx ts-prune -p tsconfig.ts-prune.json | grep -v "(used in module)"` для анализа неиспользуемых экспортов. Составить список для удаления.  
- Запустить `npx jscpd --pattern "**/*.{ts,html,scss}" --min-lines 5 --min-tokens 50` для поиска дубликатов кода. Рекомендовать извлечение в компоненты/сервисы.  
- Проанализировать зависимости: выявить циклические зависимости, неиспользуемые импорты и орфанные сервисы. Предложить исправления.  

### Анализ архитектуры:
- Составить карту связей компонентов и сервисов. Определить орфанные сервисы (неиспользуемые). Рекомендовать удаление.  
- Проверить корректность зависимостей лениво загружаемых модулей.  

---

## Фаза 2: Выявление несоответствий

### Анализ именования и паттернов:
- Проверить с помощью ESLint (Angular-правила) несоответствия в именовании компонентов, сервисов, директив. Предложить стандартизацию.  
- Выявить несоответствия в архитектуре компонентов (smart vs dumb). Рекомендовать единый стиль.  
- Найти смешанные подходы к шаблонам (inline vs external). Предложить унификацию.  
- Проверить разные подходы к обработке ошибок. Рекомендовать единый подход.  
- Выявить разные подходы к валидации форм. Предложить стандартизацию.  

### Поиск дубликатов реализаций:
- Использовать `jscpd` для анализа HTML-шаблонов, найти дубликаты для извлечения в компоненты.  
- Выявить похожую логику в компонентах для извлечения в базовые классы.  
- Найти дублирующиеся сервисы с похожими задачами. Рекомендовать объединение.  
- Выявить компоненты с похожими пропсами/входами. Предложить консолидацию.  

---

## Фаза 3: Рекомендации по модернизации (Angular 2024-2025)

### Standalone компоненты:
- Оценить возможность миграции с помощью `ng g @angular/core:standalone`.  
- Проверить импорты и удаление ненужных `NgModule`-деклараций.  
- Оценить улучшение tree-shaking и ленивой загрузки.  

### Сигналы (signals):
- Рекомендовать замену `@Input()` на `input()/input.required()`.  
- Предложить преобразование вычисляемых свойств в `computed()` сигналы.  
- Рекомендовать замену `@ViewChild()/@ViewChildren()` на `viewChild()/viewChildren()`.  
- Предложить конвертацию эффектов в `ngOnChanges` в `effect()`.  
- Рекомендовать обновление сервисов для сигналов в управлении состоянием.  

### Современный синтаксис управления потоком:
